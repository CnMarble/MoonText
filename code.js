var group,groupChange,mixX,mixY,mixZ,mixM,move;function keyRead(){output("开始解析密钥……");var i=key.indexOf("/");if(i==-1||key.length<7){error("不存在正确的密钥！请向月球人申请或索要。");return-1}var keyS=key.substr(i+1);var key1=keyS.charCodeAt(0);var key2=keyS.charCodeAt(1);var key3=keyS.charCodeAt(2);var key4=keyS.charCodeAt(3);group=[(key1&3840)>>8,(key1&240)>>4,key1&15,(key2&3840)>>8,(key2&240)>>4,key2&15];groupChange=(key4&3840)>>8;mixX=(key3&31744)>>10;mixY=(key3&992)>>5;mixZ=key3&31;mixM=(key4&240)>>4;move=key4&15;if(mixX>=10&&mixY>=10&&mixZ>=10&&mixM>0&&mixM<10&&groupChange>0){output("密钥初始化成功");output("可以开始解析");localSet("key",key)}else error("密钥初始化失败");return-1}function MoonDecrypt(base){base=moonText(base);if(base==-1)return-1;var length=base.length;var i=0;var codeArray=[];for(i=0;i<length;i++)codeArray.push(base.charCodeAt(i));var dt=groupBreak(codeArray);var DTL=dt.length;var dt3=groupBreakV2(codeArray,orderBuild(DTL));orderChange(dt3);for(i=0;i<DTL;i++)codeFix(dt3[i],i);codeArray=[];for(i=0;i<DTL;i++)codeArray=codeArray.concat(dt3[i]);codeArray=deleteFix(codeArray);var deString="";length=codeArray.length;for(i=0;i<length;i++)deString=deString+String.fromCharCode(codeArray[i]);output("解码完成");return deString}function moonText(str){var head=str.slice(0,4);if(head!="SHA/"){error("格式错误无法解码");return-1}else return str.slice(4,str.length-1)}function deleteFix(array){var i=array.length-1;for(;i>=0;i--){if(array[i]!=127)break}return array.slice(0,i+1)}function codeFix(array,p){var a=mixValue(p);for(var i=0;i<array.length;i++)array[i]-=a}function groupBreakV2(array,groupArray){var gLength=groupArray.length;var g1=0;var g2=[];for(var i=0;i<gLength;i++){g2.push(array.slice(g1,g1+groupArray[i]));g1+=groupArray[i]}return g2}function orderBuild(len){var groupArray=[];for(var i=0;i<len;i++)groupArray.push(group[i%6]);orderChange(groupArray);return groupArray}function codeMove(array){}function orderChange(array){var gc=array.length-groupChange;var changeTemp;for(var i=0;i<gc;i++){changeTemp=array[i];array[i]=array[i+groupChange];array[i+groupChange]=changeTemp;if((i+1)%groupChange==0)i+=groupChange}}function codeMix(array,p){var a=mixValue(p);for(var i=0;i<array.length;i++)array[i]+=a}function mixValue(a){var a=a%mixM;switch(a){case 0:a=mixX+mixY;break;case 1:a=mixX-mixY;break;case 2:a=mixX+mixZ;break;case 3:a=mixX-mixZ;break;case 4:a=mixY+mixZ;break;case 5:a=mixY-mixZ;break;case 6:a=mixX*mixY;break;case 7:a=mixX*mixZ;break;case 8:a=mixY*mixZ;break;default:break}return a}function groupBreak(array){var length=array.length;var g2=0;var g3=0;var g4=[];var gTemp;while(1){gTemp=array.slice(g3,g3+group[g2]);g4.push(gTemp);g3+=group[g2];if(g3>=length){var lengthTemp=group[g2]-gTemp.length;for(i=0;i<lengthTemp;i++)gTemp.push(127);break}g2++;g2%=6}return g4}function MoonEncrypt(base){var length=base.length;var i=0;var codeArray=[];for(i=0;i<length;i++)codeArray.push(base.charCodeAt(i));var gb=groupBreak(codeArray);length=gb.length;for(i=0;i<length;i++)codeMix(gb[i],i);for(i=0;i<length;i++)codeMove(gb[i]);orderChange(gb);codeArray=[];for(i=0;i<length;i++)codeArray=codeArray.concat(gb[i]);var keyString="";length=codeArray.length;for(i=0;i<length;i++)keyString=keyString+String.fromCharCode(codeArray[i]);return"SHA/"+keyString+"/"}